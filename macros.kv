<MacroButton@Button>:
    size: 100, 40
    size_hint: None, None

<MacroToggleButton@ToggleButton>:
    size: 100, 40
    size_hint: None, None
    on_press: self.parent.send(self.oncmd if self.state == 'normal' else self.offcmd)
    check:''

<MacrosWidget>:
    orientation: 'tb-lr'
    spacing: 10, 10
    padding: 10, 10
    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.5, 1
        Rectangle:
            pos: self.pos
            size: self.size

    MacroToggleButton:
        id: power_but
        text: 'Power on' if self.state == 'normal' else 'Power off'
        oncmd: 'M81'
        offcmd: 'M80'
        check: 'switch psu'

    MacroToggleButton:
        id: fan_but
        text: 'Fan on' if self.state == 'normal' else 'Fan off'
        oncmd: 'M107'
        offcmd: 'M106 S255'
        check: 'switch fan'

    MacroButton:
        text: 'Kill' if app.status != 'Alarm' else 'Clear Alarm'
        color: 1, 0, 0, 1
        on_press: root.send('\x18'); root.update_buttons() if app.status != 'Alarm' else root.send('$X') # ^X

    MacroButton:
        id: feed_hold_but
        text: 'Feed Hold' if app.status != 'Hold' else 'Resume'
        on_press: root.send('!') if app.status != 'Hold' else root.send('~')

    MacroButton:
        text: 'Reprint Last'
        disabled: app.gcode_file == ''
        on_press: app.main_window.reprint()
